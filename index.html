<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo Game & Admin</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:white; margin:0; padding:0; text-align:center; }
header { background:#00ffc3; color:#111; padding:10px; font-weight:bold; }
input { padding:8px; margin:5px; border-radius:5px; border:none; }
button { padding:8px 15px; border-radius:5px; border:none; cursor:pointer; margin:5px; }
.container { padding:20px; }
.hidden { display:none; }
table { width:100%; border-collapse: collapse; margin:10px 0; }
th, td { border:1px solid #444; padding:5px; text-align:center; }
th { background:#222; }
.number-grid { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
.number-grid button {
    width:60px;
    height:60px;
    border-radius:50%;
    margin:5px;
    font-weight:bold;
    font-size:1.2rem;
    box-shadow:0 0 8px 3px rgba(255,255,255,0.5);
    transition: transform 0.2s, box-shadow 0.2s;
    border:none;
    cursor:pointer;
    color:white;
    font-weight:bold;
    border:2px solid #fff;
}
.number-grid button:hover{
    transform: scale(1.1);
    box-shadow:0 0 12px 4px rgba(255,255,255,0.7);
}
#nextRound { margin:15px; font-weight:bold; color:#00ffc3; font-size:1.2rem; }
</style>
</head>
<body>

<header id="headerTitle">Wingo Login</header>

<!-- Login -->
<div id="loginDiv" class="container">
  <h2>Login</h2>
  <input type="text" id="username" placeholder="Email / Phone"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- Player Section -->
<div id="playerDiv" class="container hidden">
  <h2>Wingo Game</h2>
  <div id="balance"></div>
  <label>Bet Amount: <input type="number" id="betAmount" value="50000" min="30000"></label>
  
  <!-- Bet Buttons -->
  <h3>Add Bet</h3>
  <div id="betButtons">
    <button onclick="addBet(10)">+10</button>
    <button onclick="addBet(100)">+100</button>
    <button onclick="addBet(1000)">+1,000</button>
    <button onclick="addBet(10000)">+10,000</button>
  </div>
  <div id="currentBet">Current Bet: 0 MMK</div>

  <div id="timer">30</div>
  <h3>Predict Size</h3>
  <button onclick="placeBet('Big')">Big</button>
  <button onclick="placeBet('Small')">Small</button>
  <h3>Predict Color</h3>
  <button onclick="placeBet('Red')">Red</button>
  <button onclick="placeBet('Green')">Green</button>
  <button onclick="placeBet('Purple')">Purple</button>
  <h3>Predict Number</h3>
  <div id="numbers" class="number-grid"></div>
  <div id="resultSection"></div>
  <div id="historyDiv">
    <h3>Last 10 Outcomes & Serials</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<!-- Admin Section -->
<div id="adminDiv" class="container hidden">
  <div id="nextRound"></div>
  <h2>Admin Dashboard</h2>
  <h3>Players</h3>
  <table id="playersTable">
    <thead><tr><th>Player</th><th>Balance</th><th>Adjust</th><th>Action</th></tr></thead>
    <tbody></tbody>
  </table>
  <h3>Live History</h3>
  <table id="historyTable">
    <thead><tr>
      <th>Round</th><th>Player</th><th>Bet</th><th>Amount</th>
      <th>Size</th><th>Color</th><th>Number</th><th>Win/Lose</th>
      <th>#Number</th><th>#Color</th><th>Timestamp</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>

<script>
// --- Global Variables ---
let role = null;
let currentUser = '';
let balance = 100000;
let userBet = null;
let betAmount = 50000;
let currentBetAmount = 0;
let bettingStopped = false;
let historyArr = [];
let roundCount = 0;
let lastNumber = null;
let lastColor = null;
let numberSerial = 0;
let colorSerial = 0;
const ROUND_DURATION = 30;

// --- Admin credentials (hidden) ---
const ADMIN_USERNAME = "Naing";
const ADMIN_PASSWORD = "28";

// --- Next round result ---
let nextRound = {};

// --- Login Function ---
function login(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    // Admin login
    if(username === ADMIN_USERNAME && password === ADMIN_PASSWORD){
        role = 'admin';
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('adminDiv').classList.remove('hidden');
        generateNextRound();
        displayNextRound();
        loadPlayers();
        loadHistory();
        setInterval(()=>{ loadPlayers(); loadHistory(); displayNextRound(); },3000);
        return;
    }

    // Player login
    role = 'player';
    currentUser = username;
    localStorage.setItem('currentUser', currentUser);
    const bal = parseInt(localStorage.getItem(currentUser+'_balance')||'100000');
    balance = bal;
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('playerDiv').classList.remove('hidden');
    initNumbers();
    updateBalance();
    generateNextRound();
    startRoundClock();
    setInterval(checkDailyReset, 60*1000);
}

// --- Player Functions ---
function initNumbers(){
    const container = document.getElementById('numbers');
    container.innerHTML = '';
    for(let i=0;i<=9;i++){
        const btn=document.createElement('button');
        btn.textContent=i;
        if(i===0) btn.style.background='linear-gradient(135deg, red 50%, rebeccapurple 50%)';
        else if(i>=1 && i<=4) btn.style.background='red';
        else if(i===5) btn.style.background='linear-gradient(135deg, green 50%, rebeccapurple 50%)';
        else btn.style.background='green';
        btn.onclick=()=>placeBet(i);
        container.appendChild(btn);
    }
}

function updateBalance(){
    document.getElementById('balance').textContent=`Balance: ${balance.toLocaleString()} MMK`;
    localStorage.setItem(currentUser+'_balance', balance);
}

// --- Betting functions ---
function addBet(amount){
    if(bettingStopped){
        alert("Betting is closed for this round!");
        return;
    }
    currentBetAmount += amount;
    document.getElementById('currentBet').textContent = `Current Bet: ${currentBetAmount.toLocaleString()} MMK`;
}

function placeBet(choice){
    if(bettingStopped){
        alert("Betting is closed for this round!");
        return;
    }
    betAmount = currentBetAmount;
    if(betAmount < 30000){ alert("Minimum bet 30,000"); return; }
    if(betAmount > balance){ alert("Insufficient balance"); return; }
    userBet = choice;
    document.getElementById('resultSection').textContent = `You bet ${betAmount.toLocaleString()} on ${choice}`;
}

// --- Myanmar Time & Rounds ---
function getMyanmarTime(){ return new Date(new Date().getTime()+6.5*60*60*1000); }

function getRoundCountdown(){
    const mmt = getMyanmarTime();
    const startDay = new Date(mmt); startDay.setHours(6,30,0,0);
    const diffSec = Math.floor((mmt - startDay)/1000);
    let countdown = ROUND_DURATION - (diffSec % ROUND_DURATION);
    if(countdown===0) countdown = ROUND_DURATION;
    return countdown;
}

function startRoundClock(){
    const timerEl=document.getElementById('timer');
    function updateTimer(){
        const countdown = getRoundCountdown();
        timerEl.textContent = countdown;
        bettingStopped = countdown <= 7; // stop betting when â‰¤ 7 seconds
        if(countdown===1) {
            currentBetAmount = 0;
            document.getElementById('currentBet').textContent = `Current Bet: 0 MMK`;
            playRound();
        }
    }
    updateTimer();
    setInterval

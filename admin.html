<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CoinPay Admin Panel</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0D0D0D;color:#fff;padding:10px;}
.header{text-align:center;margin-bottom:15px;}
.header h1{color:#00FFAA;animation: glow 1.5s infinite alternate;}
@keyframes glow{0%{text-shadow:0 0 5px #00FFAA;}50%{text-shadow:0 0 20px #00CFFF;}100%{text-shadow:0 0 5px #00FFAA;}}
.stats{display:flex;justify-content:space-around;margin-bottom:15px;}
.stats div{background:#111;padding:10px 15px;border-radius:12px;text-align:center;}
.feed{background:#1A1A1A;border-radius:12px;padding:10px;}
.transaction{background:#222;padding:10px;border-radius:10px;margin-bottom:10px;display:flex;flex-direction:column;transition:all 0.3s;}
.transaction.approved{border-left:5px solid #00FFAA;}
.transaction.rejected{border-left:5px solid #FF4D4D;}
.transaction img{max-width:100%;margin-top:5px;border-radius:8px;}
.btn{padding:6px 10px;margin-top:5px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;}
.approve{background:#00FFAA;color:#000;}
.reject{background:#FF4D4D;color:#fff;}
.search{margin-bottom:10px;}
.search input{width:100%;padding:10px;border-radius:8px;border:none;background:#222;color:#fff;}
.logout{position:absolute;top:10px;right:10px;padding:8px 12px;border:none;border-radius:10px;background:#FF4D4D;color:#fff;cursor:pointer;}
</style>
</head>
<body>

<canvas id="confettiCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;"></canvas>

<div class="header"><h1>CoinPay Admin Panel</h1></div>
<button class="logout" onclick="logout()">Logout</button>

<div class="stats">
    <div>Total MMK:<br><span id="totalMMK">0</span></div>
    <div>Transactions:<br><span id="totalTx">0</span></div>
</div>

<div class="search">
    <input type="text" id="searchInput" placeholder="Search by phone or last 6 digits">
</div>

<div class="feed" id="adminFeed"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
// Check admin login
if(sessionStorage.getItem('adminLoggedIn')!=='true'){
    window.location.href='admin-login.html';
}

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBbQfwr1r9DbDJML-ltodMSdIHwCjYETUU",
  authDomain: "wingo-fa082.firebaseapp.com",
  projectId: "wingo-fa082",
  storageBucket: "wingo-fa082.firebasestorage.app",
  messagingSenderId: "90412304535",
  appId: "1:90412304535:web:38c1fbe667c58db49381d2",
  measurementId: "G-196W4KRSJZ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Logout
function logout(){
    sessionStorage.removeItem('adminLoggedIn');
    window.location.href='admin-login.html';
}

// Confetti setup
const confettiCanvas=document.getElementById('confettiCanvas');
const ctx=confettiCanvas.getContext('2d');
confettiCanvas.width=window.innerWidth;
confettiCanvas.height=window.innerHeight;
let confettiParticles=[];
let confettiInterval;

function createConfetti(colorHue=null){
    for(let i=0;i<150;i++){
        let hue = colorHue !== null ? colorHue : Math.random()*360;
        confettiParticles.push({
            x: Math.random()*confettiCanvas.width,
            y: Math.random()*confettiCanvas.height - confettiCanvas.height,
            r: Math.random()*6 + 4,
            d: Math.random()*50 + 50,
            color: `hsl(${hue},100%,50%)`,
            tilt: Math.random()*10 - 10,
            tiltAngleIncrement: Math.random()*0.07+0.05,
            tiltAngle: 0
        });
    }
}

function drawConfetti(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    confettiParticles.forEach((p,i)=>{
        ctx.beginPath();
        ctx.lineWidth=p.r/2;
        ctx.strokeStyle=p.color;
        ctx.moveTo(p.x+p.tilt+p.r/4,p.y);
        ctx.lineTo(p.x+p.tilt,p.y+p.tilt+p.r/4);
        ctx.stroke();
        p.tiltAngle+=p.tiltAngleIncrement;
        p.y+=(Math.cos(p.d)+3+p.r/2)/2;
        p.x+=Math.sin(p.d);
        p.tilt=Math.sin(p.tiltAngle)*15;
        if(p.y>confettiCanvas.height){
            confettiParticles[i]={...p,x:Math.random()*confettiCanvas.width,y:-10};
        }
    });
}

function startConfetti(colorHue=null){
    createConfetti(colorHue);
    confettiInterval=setInterval(drawConfetti,20);
    setTimeout(()=>{
        clearInterval(confettiInterval);
        confettiParticles=[];
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    },3000);
}

// Admin feed
const feed=document.getElementById('adminFeed');
const totalMMK=document.getElementById('totalMMK');
const totalTx=document.getElementById('totalTx');
const searchInput=document.getElementById('searchInput');

db.collection('transactions').orderBy('timestamp','desc').onSnapshot(snapshot=>{
    feed.innerHTML='';
    let total=0;
    snapshot.forEach(doc=>{
        const tx=doc.data();
        if(tx.status==='approved') total+=tx.amount;
        if(!tx.phone.includes(searchInput.value)&&!tx.last6.includes(searchInput.value)) return;
        const div=document.createElement('div'); div.className='transaction';
        if(tx.status==='approved') div.classList.add('approved');
        if(tx.status==='rejected') div.classList.add('rejected');
        div.innerHTML=`
            <div><strong>Phone:</strong> ${tx.phone}</div>
            <div><strong>Amount:</strong> ${tx.amount.toLocaleString()} MMK</div>
            <div><strong>Last6:</strong> ${tx.last6}</div>
            ${tx.photoURL?`<img src="${tx.photoURL}" />`:''}
            <div>
                <button class="btn approve">Approve</button>
                <button class="btn reject">Reject</button>
            </div>
        `;
        div.querySelector('.approve').onclick=()=>{
            db.collection('transactions').doc(doc.id).update({status:'approved'});
            startConfetti(); // green/multicolor
        };
        div.querySelector('.reject').onclick=()=>{
            db.collection('transactions').doc(doc.id).update({status:'rejected'});
            startConfetti(0); // red
        };
        feed.appendChild(div);
    });
    totalMMK.textContent=total.toLocaleString();
    totalTx.textContent=snapshot.size;
});

searchInput.addEventListener('input',()=>{ /* snapshot listener auto-filters */ });
</script>

</body>
</html>
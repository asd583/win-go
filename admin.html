<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo Admin Dashboard</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:white; margin:0; padding:0; }
header { background:#00ffc3; color:#111; padding:10px; text-align:center; font-weight:bold; }
.container { padding:20px; }
table { width:100%; border-collapse: collapse; margin-bottom:20px; }
th, td { padding:10px; text-align:center; border:1px solid #444; }
th { background:#222; }
input[type=number] { width:80px; }
button { padding:5px 10px; margin:2px; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>
<header>Wingo Admin Dashboard</header>
<div class="container">
<h2>Player Balances & Controls</h2>
<table id="playersTable">
  <thead>
    <tr>
      <th>Player</th>
      <th>Balance (MMK)</th>
      <th>Add/Subtract</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Live Game History</h2>
<table id="historyTable">
  <thead>
    <tr>
      <th>Round</th>
      <th>Player</th>
      <th>Bet</th>
      <th>Amount</th>
      <th>Size</th>
      <th>Color</th>
      <th>Number</th>
      <th>Win/Lose</th>
      <th>#Number Serial</th>
      <th>#Color Serial</th>
      <th>Timestamp</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>
// Load players from localStorage
function loadPlayers() {
    const tbody = document.querySelector('#playersTable tbody');
    tbody.innerHTML = '';
    // Find all keys ending with "_balance"
    for(const key in localStorage){
        if(key.endsWith('_balance')){
            const player = key.replace('_balance','');
            const balance = localStorage.getItem(key);
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${player}</td>
                <td id="${player}_bal">${parseInt(balance).toLocaleString()}</td>
                <td><input type="number" id="${player}_input" value="0"></td>
                <td>
                  <button onclick="updateBalance('${player}')">Update</button>
                </td>
            `;
            tbody.appendChild(tr);
        }
    }
}

// Update player balance
function updateBalance(player){
    const inputVal = parseInt(document.getElementById(player+'_input').value) || 0;
    let balance = parseInt(localStorage.getItem(player+'_balance') || '0');
    balance += inputVal;
    localStorage.setItem(player+'_balance', balance);
    document.getElementById(player+'_bal').textContent = balance.toLocaleString();
    document.getElementById(player+'_input').value = 0;
}

// Load live history
function loadHistory(){
    const tbody = document.querySelector('#historyTable tbody');
    tbody.innerHTML = '';
    const history = JSON.parse(localStorage.getItem('bets') || '[]');
    for(let i=history.length-1;i>=0;i--){ // newest first
        const h = history[i];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${h.round}</td>
          <td>${h.player}</td>
          <td>${h.bet}</td>
          <td>${h.amount.toLocaleString()}</td>
          <td>${h.size}</td>
          <td>${h.color}</td>
          <td>${h.number}</td>
          <td>${h.win?'WIN':'LOSE'}</td>
          <td>${h.numberSerial}</td>
          <td>${h.colorSerial}</td>
          <td>${h.timestamp}</td>
        `;
        tbody.appendChild(tr);
    }
}

// Auto refresh every 3 seconds
setInterval(()=>{
    loadPlayers();
    loadHistory();
},3000);

// Initial load
loadPlayers();
loadHistory();
</script>
</body>
</html>
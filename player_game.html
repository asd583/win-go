<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo Game</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:white; text-align:center; margin:0; padding:0; }
header { background:#00ffc3; color:#111; padding:10px; font-size:1.2rem; font-weight:bold; }
h1 { margin:20px 0; color:#00ffc3; }
#balance { margin:15px 0; font-size:1.2rem; }
button { border:none; border-radius:15px; padding:12px 25px; margin:5px; font-size:1rem; cursor:pointer; transition:0.2s; }
button:hover { transform:scale(1.05); }
.big { background:#ff4d4d; } .small { background:#4d79ff; }
.red { background:#ff1a1a; } .green { background:#33cc33; } .purple { background:#9933ff; }
.number { color:white; font-weight:bold; }
#timer { font-size:2rem; margin:10px; }
#betSection, #resultSection { margin:15px auto; width:95%; max-width:600px; padding:15px; background:#222; border-radius:15px; }
#history ul { list-style:none; padding:0; max-height:200px; overflow-y:auto; }
#history li { background:#333; margin:3px 0; padding:5px 10px; border-radius:10px; text-align:left; }
.slide { animation:slideUp 0.5s forwards; }
@keyframes slideUp { from {transform:translateY(100%);} to {transform:translateY(0);} }
.number-grid { display:flex; flex-wrap:wrap; justify-content:center; }
.number-grid button { width:60px; height:60px; border-radius:50%; margin:5px; font-weight:bold; font-size:1.1rem; cursor:pointer; transition:0.2s; position:relative; }
.number-grid button:hover { transform:scale(1.1); }
</style>
</head>
<body>

<header id="welcome"></header>
<h1>Wingo Game</h1>
<div id="balance"></div>

<div id="betSection">
  <label>Bet Amount: <input type="number" id="betAmount" value="50000" min="30000"></label>
  <div id="timer">30</div>

  <h2>Predict Size</h2>
  <button class="big" onclick="placeBet('Big')">Big</button>
  <button class="small" onclick="placeBet('Small')">Small</button>

  <h2>Predict Color</h2>
  <button class="red" onclick="placeBet('Red')">Red</button>
  <button class="green" onclick="placeBet('Green')">Green</button>
  <button class="purple" onclick="placeBet('Purple')">Purple</button>

  <h2>Predict Number (0-9)</h2>
  <div id="numbers" class="number-grid"></div>
</div>

<div id="resultSection">
  <div id="result"></div>
  <div id="history">
    <h3>Last 10 Outcomes & Serials:</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<script>
// --- Initialization ---
let player = localStorage.getItem('currentUser');
if(!player){ window.location.href="signin.html"; }
document.getElementById('welcome').textContent = `Welcome, ${player}!`;

let balance = parseInt(localStorage.getItem(player+'_balance')||'100000');
let userBet = null;
let betAmount = 50000;
let historyArr = [];
let roundCount = 0;
let lastNumber = null;
let lastColor = null;
let numberSerial = 0;
let colorSerial = 0;
const ROUND_DURATION = 30; // seconds

// --- Functions ---
function initNumbers(){
  const container = document.getElementById('numbers');
  container.innerHTML = '';
  for(let i=0;i<=9;i++){
    const btn = document.createElement('button');
    btn.textContent = i;

    // Dual-color logic
    if(i===0){
      btn.style.background='linear-gradient(135deg, red 50%, rebeccapurple 50%)';
    } else if(i>=1 && i<=4){
      btn.style.background='red';
    } else if(i===5){
      btn.style.background='linear-gradient(135deg, green 50%, rebeccapurple 50%)';
    } else if(i>=6 && i<=9){
      btn.style.background='green';
    }

    // Glow for visibility
    btn.style.boxShadow = '0 0 6px 2px rgba(255,255,255,0.5)';
    btn.onclick = ()=>placeBet(i);
    container.appendChild(btn);
  }
}
initNumbers();

function updateBalance(){
  document.getElementById('balance').textContent = `Balance: ${balance.toLocaleString()} MMK`;
  localStorage.setItem(player+'_balance', balance);
}

function placeBet(choice){
  betAmount = parseInt(document.getElementById('betAmount').value) || 30000;
  if(betAmount < 30000){ alert("Minimum bet is 30,000 MMK"); return; }
  if(betAmount > balance){ alert("Insufficient balance"); return; }
  userBet = choice;
  document.getElementById('result').textContent = `You bet ${betAmount.toLocaleString()} MMK on ${choice}`;
  document.getElementById('resultSection').classList.add('slide');
}

// --- Myanmar Time ---
function getMyanmarTime() {
    const now = new Date();
    return new Date(now.getTime() + 6.5*60*60*1000); // UTC+6:30
}

// --- Daily Reset at 6:30 AM MMT ---
function checkDailyReset() {
    const mmt = getMyanmarTime();
    const hour = mmt.getHours();
    const minute = mmt.getMinutes();

    if(hour === 6 && minute === 30){
        historyArr = [];
        roundCount = 0;
        lastNumber = null;
        lastColor = null;
        numberSerial = 0;
        colorSerial = 0;
        renderHistory();
        console.log("Daily reset at 6:30 AM MMT completed.");
    }
}
setInterval(checkDailyReset, 60*1000); // check every minute

// --- Countdown & Rounds ---
function getRoundCountdown() {
    const mmt = getMyanmarTime();
    const startOfDay = new Date(mmt);
    startOfDay.setHours(6,30,0,0); // 6:30 AM Myanmar Time

    const diffSec = Math.floor((mmt - startOfDay)/1000);
    let countdown = ROUND_DURATION - (diffSec % ROUND_DURATION);
    if(countdown === 0) countdown = ROUND_DURATION;
    return countdown;
}

function startRoundClock() {
    const timerEl = document.getElementById('timer');

    function updateTimer() {
        const countdown = getRoundCountdown();
        timerEl.textContent = countdown;
        if(countdown === 1){ // trigger round
            playRound();
        }
    }

    updateTimer();
    setInterval(updateTimer, 1000);
}

// --- Play Round ---
function playRound(){
  roundCount++;
  const sizes=['Big','Small'];
  const colors=['Red','Green','Purple'];
  const numbers=[0,1,2,3,4,5,6,7,8,9];

  const sizeResult = sizes[Math.floor(Math.random()*sizes.length)];
  const colorResult = colors[Math.floor(Math.random()*colors.length)];
  const numberResult = numbers[Math.floor(Math.random()*numbers.length)];

  // Serial tracking
  if(numberResult === lastNumber){ numberSerial++; } else { numberSerial = 1; lastNumber = numberResult; }
  if(colorResult === lastColor){ colorSerial++; } else { colorSerial = 1; lastColor = colorResult; }

  let win=false;
  if(userBet===sizeResult || userBet===colorResult || userBet===numberResult) win=true;
  if(win) balance += betAmount; else balance -= betAmount;
  updateBalance();

  historyArr.unshift({
    round: roundCount,
    size:sizeResult, color:colorResult, number:numberResult, win,
    numberSerial, colorSerial,
    playerBet:userBet, amount:betAmount
  });
  if(historyArr.length>10) historyArr.pop();
  renderHistory();

  // Admin tracking
  const allBets = JSON.parse(localStorage.getItem('bets')||'[]');
  allBets.push({
    player, bet:userBet, amount:betAmount,
    size:sizeResult, color:colorResult, number:numberResult,
    win, timestamp:getMyanmarTime().toLocaleString(),
    balance, numberSerial, colorSerial
  });
  localStorage.setItem('bets', JSON.stringify(allBets));

  document.getElementById('result').textContent=
    `Round ${
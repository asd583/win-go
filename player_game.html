<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo Game</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:white; text-align:center; margin:0; padding:0; }
header { background:#00ffc3; color:#111; padding:10px; font-size:1.2rem; font-weight:bold; }
h1 { margin:20px 0; color:#00ffc3; }
#balance { margin:15px 0; font-size:1.2rem; }
button { border:none; border-radius:15px; padding:12px 25px; margin:5px; font-size:1rem; cursor:pointer; transition:0.2s; }
button:hover { transform:scale(1.05); }
.big { background:#ff4d4d; } .small { background:#4d79ff; }
.red { background:#ff1a1a; } .green { background:#33cc33; } .purple { background:#9933ff; }
.number { color:white; font-weight:bold; }
#timer { font-size:2rem; margin:10px; }
#betSection, #resultSection { margin:15px auto; width:95%; max-width:600px; padding:15px; background:#222; border-radius:15px; }
#history ul { list-style:none; padding:0; max-height:200px; overflow-y:auto; }
#history li { background:#333; margin:3px 0; padding:5px 10px; border-radius:10px; text-align:left; }
.slide { animation:slideUp 0.5s forwards; }
@keyframes slideUp { from {transform:translateY(100%);} to {transform:translateY(0);} }
.number-grid { display:flex; flex-wrap:wrap; justify-content:center; }
.number-grid button { width:60px; height:60px; border-radius:50%; margin:5px; font-weight:bold; font-size:1.1rem; cursor:pointer; transition:0.2s; }
.number-grid button:hover { transform:scale(1.1); }
</style>
</head>
<body>

<header id="welcome"></header>
<h1>Wingo Game</h1>
<div id="balance"></div>

<div id="betSection">
  <label>Bet Amount: <input type="number" id="betAmount" value="50000" min="30000"></label>
  <div id="timer">30</div>

  <h2>Predict Size</h2>
  <button class="big" onclick="placeBet('Big')">Big</button>
  <button class="small" onclick="placeBet('Small')">Small</button>

  <h2>Predict Color</h2>
  <button class="red" onclick="placeBet('Red')">Red</button>
  <button class="green" onclick="placeBet('Green')">Green</button>
  <button class="purple" onclick="placeBet('Purple')">Purple</button>

  <h2>Predict Number (0-9)</h2>
  <div id="numbers" class="number-grid"></div>
</div>

<div id="resultSection">
  <div id="result"></div>
  <div id="history">
    <h3>Last 10 Outcomes & Serials:</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<script>
// --- Initialization ---
let player = localStorage.getItem('currentUser');
if(!player){ window.location.href="signin.html"; }
document.getElementById('welcome').textContent = `Welcome, ${player}!`;

let balance = parseInt(localStorage.getItem(player+'_balance')||'100000');
let userBet = null;
let betAmount = 50000;
let countdown = 30;
let historyArr = [];

let roundCount = 0;
let lastNumber = null;
let lastColor = null;
let numberSerial = 0;
let colorSerial = 0;

// --- Functions ---
function initNumbers(){
  const container = document.getElementById('numbers');
  container.innerHTML = '';
  for(let i=0;i<=9;i++){
    const btn = document.createElement('button');
    btn.textContent = i;

    // Dual-color logic
    if(i===0){
      btn.style.background='linear-gradient(135deg, red 50%, rebeccapurple 50%)';
    } else if(i>=1 && i<=4){
      btn.style.background='red';
    } else if(i===5){
      btn.style.background='linear-gradient(135deg, green 50%, rebeccapurple 50%)';
    } else if(i>=6 && i<=9){
      btn.style.background='green';
    }
    
    btn.onclick = ()=>placeBet(i);
    container.appendChild(btn);
  }
}
initNumbers();

function updateBalance(){
  document.getElementById('balance').textContent = `Balance: ${balance.toLocaleString()} MMK`;
  localStorage.setItem(player+'_balance', balance);
}

function placeBet(choice){
  betAmount = parseInt(document.getElementById('betAmount').value) || 30000;
  if(betAmount < 30000){ alert("Minimum bet is 30,000 MMK"); return; }
  if(betAmount > balance){ alert("Insufficient balance"); return; }
  userBet = choice;
  document.getElementById('result').textContent = `You bet ${betAmount.toLocaleString()} MMK on ${choice}`;
  document.getElementById('resultSection').classList.add('slide');
}

function startTimer(){
  setInterval(()=>{
    document.getElementById('timer').textContent = countdown;
    countdown--;
    if(countdown<0){
      countdown=30;
      playRound();
    }
  },1000);
}

function playRound(){
  roundCount++;
  const sizes=['Big','Small'];
  const colors=['Red','Green','Purple'];
  const numbers=[0,1,2,3,4,5,6,7,8,9];

  const sizeResult = sizes[Math.floor(Math.random()*sizes.length)];
  const colorResult = colors[Math.floor(Math.random()*colors.length)];
  const numberResult = numbers[Math.floor(Math.random()*numbers.length)];

  // Check serials
  if(numberResult === lastNumber){ numberSerial++; } else { numberSerial = 1; lastNumber = numberResult; }
  if(colorResult === lastColor){ colorSerial++; } else { colorSerial = 1; lastColor = colorResult; }

  let win=false;
  if(userBet===sizeResult || userBet===colorResult || userBet===numberResult) win=true;
  if(win) balance += betAmount; else balance -= betAmount;
  updateBalance();

  historyArr.unshift({
    round: roundCount,
    size:sizeResult, color:colorResult, number:numberResult, win,
    numberSerial, colorSerial,
    playerBet:userBet, amount:betAmount
  });
  if(historyArr.length>10) historyArr.pop();
  renderHistory();

  // Save for admin
  const allBets = JSON.parse(localStorage.getItem('bets')||'[]');
  allBets.push({
    player, bet:userBet, amount:betAmount,
    size:sizeResult, color:colorResult, number:numberResult,
    win, timestamp:new Date().toLocaleString(),
    balance, numberSerial, colorSerial
  });
  localStorage.setItem('bets', JSON.stringify(allBets));

  document.getElementById('result').textContent=
    `Round ${roundCount} → Size: ${sizeResult}, Color: ${colorResult}, Number: ${numberResult}. ${win?'WIN!':'LOSE!'}`;
  userBet=null;
}

function renderHistory(){
  const ul = document.getElementById('historyList');
  ul.innerHTML='';
  historyArr.forEach(h=>{
    const li=document.createElement('li');
    li.textContent=
      `Round ${h.round}: Bet:${h.playerBet} Amt:${h.amount.toLocaleString()} → Result: Size:${h.size}, Color:${h.color} (#${h.colorSerial}), Number:${h.number} (#${h.numberSerial}) → ${h.win?'WIN':'LOSE'}`;
    ul.appendChild(li);
  });
}

updateBalance();
startTimer();
</script>
</body>
</html>

// --- Myanmar Time Based Countdown ---
function getMyanmarTime() {
    const now = new Date();
    // Convert UTC to MMT (UTC+6:30)
    const mmtTime = new Date(now.getTime() + 6.5*60*60*1000);
    return mmtTime;
}

// Game settings
const ROUND_DURATION = 30; // seconds

function startRoundClock() {
    const timerEl = document.getElementById('timer');

    function updateTimer() {
        const mmtNow = getMyanmarTime();
        const seconds = mmtNow.getSeconds();
        const countdown = ROUND_DURATION - (seconds % ROUND_DURATION);
        timerEl.textContent = countdown;

        if(countdown === 0) playRound();
    }

    updateTimer(); // initialize immediately
    setInterval(updateTimer, 1000);
}

startRoundClock();
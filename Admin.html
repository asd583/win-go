<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wingo Game & Admin</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:white; margin:0; padding:0; text-align:center; }
header { background:#00ffc3; color:#111; padding:10px; font-weight:bold; }
input { padding:8px; margin:5px; border-radius:5px; border:none; }
button { padding:8px 15px; border-radius:5px; border:none; cursor:pointer; margin:5px; }
.container { padding:20px; }
.hidden { display:none; }
table { width:100%; border-collapse: collapse; margin:10px 0; }
th, td { border:1px solid #444; padding:5px; text-align:center; }
th { background:#222; }
.number-grid { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
.number-grid button { width:50px; height:50px; border-radius:50%; margin:3px; font-weight:bold; font-size:1rem; box-shadow:0 0 6px 2px rgba(255,255,255,0.5); }
#nextRound { margin:15px; font-weight:bold; color:#00ffc3; font-size:1.2rem; }
</style>
</head>
<body>

<header id="headerTitle">Wingo Login</header>

<!-- Login -->
<div id="loginDiv" class="container">
  <h2>Login</h2>
  <input type="text" id="username" placeholder="Email / Phone"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
</div>

<!-- Player Section -->
<div id="playerDiv" class="container hidden">
  <h2>Wingo Game</h2>
  <div id="balance"></div>
  <label>Bet Amount: <input type="number" id="betAmount" value="50000" min="30000"></label>
  <div id="timer">30</div>
  <h3>Predict Size</h3>
  <button onclick="placeBet('Big')">Big</button>
  <button onclick="placeBet('Small')">Small</button>
  <h3>Predict Color</h3>
  <button onclick="placeBet('Red')">Red</button>
  <button onclick="placeBet('Green')">Green</button>
  <button onclick="placeBet('Purple')">Purple</button>
  <h3>Predict Number</h3>
  <div id="numbers" class="number-grid"></div>
  <div id="resultSection"></div>
  <div id="historyDiv">
    <h3>Last 10 Outcomes & Serials</h3>
    <ul id="historyList"></ul>
  </div>
</div>

<!-- Admin Section -->
<div id="adminDiv" class="container hidden">
  <div id="nextRound"></div>
  <h2>Admin Dashboard</h2>
  <h3>Players</h3>
  <table id="playersTable">
    <thead><tr><th>Player</th><th>Balance</th><th>Adjust</th><th>Action</th></tr></thead>
    <tbody></tbody>
  </table>
  <h3>Live History</h3>
  <table id="historyTable">
    <thead><tr>
      <th>Round</th><th>Player</th><th>Bet</th><th>Amount</th>
      <th>Size</th><th>Color</th><th>Number</th><th>Win/Lose</th>
      <th>#Number</th><th>#Color</th><th>Timestamp</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</div>

<script>
// --- Global Variables ---
let role = null;
let currentUser = '';
let balance = 100000;
let userBet = null;
let betAmount = 50000;
let historyArr = [];
let roundCount = 0;
let lastNumber = null;
let lastColor = null;
let numberSerial = 0;
let colorSerial = 0;
const ROUND_DURATION = 30;

// --- Admin credentials (hidden) ---
const ADMIN_USERNAME = "Naing";
const ADMIN_PASSWORD = "28";

// --- Next round result ---
let nextRound = {};

// --- Login Function ---
function login(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    // Admin login
    if(username === ADMIN_USERNAME && password === ADMIN_PASSWORD){
        role = 'admin';
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('adminDiv').classList.remove('hidden');
        generateNextRound();
        displayNextRound();
        loadPlayers();
        loadHistory();
        setInterval(()=>{ loadPlayers(); loadHistory(); displayNextRound(); },3000);
        return;
    }

    // Player login
    role = 'player';
    currentUser = username;
    localStorage.setItem('currentUser', currentUser);
    const bal = parseInt(localStorage.getItem(currentUser+'_balance')||'100000');
    balance = bal;
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('playerDiv').classList.remove('hidden');
    initNumbers();
    updateBalance();
    generateNextRound();
    startRoundClock();
    setInterval(checkDailyReset, 60*1000);
}

// --- Player Functions ---
function initNumbers(){
    const container = document.getElementById('numbers');
    container.innerHTML = '';
    for(let i=0;i<=9;i++){
        const btn=document.createElement('button');
        btn.textContent=i;
        if(i===0) btn.style.background='linear-gradient(135deg, red 50%, rebeccapurple 50%)';
        else if(i>=1 && i<=4) btn.style.background='red';
        else if(i===5) btn.style.background='linear-gradient(135deg, green 50%, rebeccapurple 50%)';
        else btn.style.background='green';
        btn.onclick=()=>placeBet(i);
        container.appendChild(btn);
    }
}

function updateBalance(){
    document.getElementById('balance').textContent=`Balance: ${balance.toLocaleString()} MMK`;
    localStorage.setItem(currentUser+'_balance', balance);
}

function placeBet(choice){
    betAmount=parseInt(document.getElementById('betAmount').value)||30000;
    if(betAmount<30000){ alert("Minimum bet 30,000"); return; }
    if(betAmount>balance){ alert("Insufficient balance"); return; }
    userBet=choice;
    document.getElementById('resultSection').textContent=`You bet ${betAmount.toLocaleString()} on ${choice}`;
}

// --- Myanmar Time & Rounds ---
function getMyanmarTime(){ return new Date(new Date().getTime()+6.5*60*60*1000); }

function getRoundCountdown(){
    const mmt = getMyanmarTime();
    const startDay = new Date(mmt); startDay.setHours(6,30,0,0);
    const diffSec = Math.floor((mmt - startDay)/1000);
    let countdown = ROUND_DURATION - (diffSec % ROUND_DURATION);
    if(countdown===0) countdown = ROUND_DURATION;
    return countdown;
}

function startRoundClock(){
    const timerEl=document.getElementById('timer');
    function updateTimer(){
        const countdown = getRoundCountdown();
        timerEl.textContent=countdown;
        if(countdown===1) playRound();
    }
    updateTimer();
    setInterval(updateTimer,1000);
}

// --- Generate Next Round ---
function generateNextRound() {
    const sizes=['Big','Small'];
    const colors=['Red','Green','Purple'];
    const numbers=[0,1,2,3,4,5,6,7,8,9];

    const sizeResult = sizes[Math.floor(Math.random()*sizes.length)];
    const colorResult = colors[Math.floor(Math.random()*colors.length)];
    const numberResult = numbers[Math.floor(Math.random()*numbers.length)];

    nextRound = {size:sizeResult, color:colorResult, number:numberResult};
}

// --- Display Next Round (Admin only) ---
function displayNextRound(){
    if(role==='admin'){
        const nextDiv = document.getElementById('nextRound');
        nextDiv.textContent = `Next Winning Number: ${nextRound.number} | Color: ${nextRound.color} | Size: ${nextRound.size}`;
    }
}

// --- Play Round ---
function playRound(){
    roundCount++;
    const sizeResult = nextRound.size;
    const colorResult = nextRound.color;
    const numberResult = nextRound.number;

    generateNextRound(); // generate next for future
    displayNextRound();

    if(numberResult===lastNumber) numberSerial++; else { numberSerial=1; lastNumber=numberResult; }
    if(colorResult===lastColor) colorSerial++; else { colorSerial=1; lastColor=colorResult; }

    let win=false;
    if(userBet===sizeResult||userBet===colorResult||userBet===numberResult) win=true;
    if(win) balance+=betAmount; else balance-=betAmount;
    updateBalance();

    historyArr.unshift({round:roundCount,size:sizeResult,color:colorResult,number:numberResult,win,userBet,amount:betAmount,numberSerial,colorSerial});
    if(historyArr.length>10) historyArr.pop();
    renderHistory();

    const allBets=JSON.parse(localStorage.getItem('bets')||'[]');
    allBets.push({
        player:currentUser,bet:userBet,amount:betAmount,size:sizeResult,color:colorResult,number:numberResult,
        win, timestamp:getMyanmarTime().toLocaleString(),balance,numberSerial,colorSerial,round:roundCount
    });
    localStorage.setItem('bets', JSON.stringify(allBets));
    userBet=null;
    if(role==='admin') loadHistory();
}

// --- Render History ---
function renderHistory(){
    const ul=document.getElementById('historyList');
    if(!ul) return;
    ul.innerHTML='';
    historyArr.forEach(h=>{
        const li=document.createElement('li');
        li.textContent=`Round ${h.round}: Bet:${h.userBet} Amt:${h.amount.toLocaleString()} → Size:${h.size}, Color:${h.color}, Number:${h.number} (#${h.numberSerial},#${h.colorSerial}) → ${h.win?'WIN':'LOSE'}`;
        ul.appendChild